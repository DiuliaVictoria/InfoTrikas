<!DOCTYPE html>
<html lang="pt">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quiz | Info Trikas</title>
    <link rel="stylesheet" href="css/jogo.css">
    <link rel="shortcut icon" href="img/São_Paulo_Futebol_Clube.png">
    <script type="text/javascript" src="https://www.chartjs.org/dist/2.8.0/Chart.min.js"></script>
</head>

<body>

    <div class="screen" id="screen_img">

        <div class="menu" id="menu">

            <figure class="logo">
                <a href="index.html"><img src="img/Info__2_-removebg-preview.png" alt="Logo"></a>
            </figure>

            <div class="top_menu">
                <span id="message">Vivemos pelo amor a essa camisa</span>
            </div>

            <div class="down_menu">
                <a href="spfc.html"> <button class="button_menu" id="button_spfc">SPFC</button></a>
                <a href="musicas.html"> <button class="button_menu" id="button_msc"> Musicas </button> </a>

                <button class="button_menu" id="button_menu" onclick="aparecer_quiz()">Jogar o Quiz</button>

                <button class="button_restart" id="button_restart" onClick="window.location.reload()">Voltar</button>

                <a href="index.html"><button class="button_menu">Sair</button></a>
            </div>
       
            <div id="card" class="cardClass">
                <canvas id="myChart"></canvas>
            <li>Bem Vindo!</li>
            <li>Agora você faz parte dessa comunidade incrivel...</li>
            <li>Navegue pelo site e divirta-se</li>
            </div>

        </div>

       
        
        <div id="quiz_content">
          
            <div class="title_questions">
                <p> Teste aqui seus conhecimentos sobre o maior clube do Brasil!!!!</p>
            </div>

            <div class="play">

                <button class="button_play" onclick="jogar()">JOGAR</button>
            </div>
        </div>

        <div id="questions1" class="questions">
            <div class="title_questions">
                <p>1 - Em que ano o São Paulo conquistou seu primeiro título oficial?</p>
            </div>

            <div class="alternatives">
                <button class="button_alternatives" onclick="errou()">1935</button>
                <button class="button_alternatives" onclick="acertou()">1931</button>
                <button class="button_alternatives" onclick="errou()">1942</button>
                <button class="button_alternatives" onclick="errou()">1930</button>
            </div>
        </div>

        <div id="questions2" class="questions">
            <div class="title_questions">
                <p>2 - Qual o significado das 3 estrelas vermelhas no simbolo do São Paulo? </p>
            </div>

            <div class="alternatives">
                <button class="button_alternatives" onclick="errou()">3 Mundiais</button>
                <button class="button_alternatives" onclick="acertou()">3 Libertadores </button>
                <button class="button_alternatives" onclick="errou()">3 Brasileiros</button>
                <button class="button_alternatives" onclick="errou()">3 Sulamericanos</button>
            </div>
        </div>

        <div id="questions3" class="questions">
            <div class="title_questions">
                <p>3 -Qual o treinador que conquistou os três Brasileiros Consecutivos pelo São Paulo?</p>
            </div>

            <div class="alternatives">

                <button class="button_alternatives" onclick="errou()">Paulo Autuori</button>
                <button class="button_alternatives" onclick="errou()">Rubens Minelli</button>
                <button class="button_alternatives" onclick="errou()">Dorival Junior</button>
                <button class="button_alternatives" onclick="acertou()">Muricy Ramalho</button>
                <button class="button_alternatives" onclick="errou()">Tele Santana</button>
            </div>
        </div>

        <div id="questions4" class="questions">
            <div class="title_questions">
                <p>4 - Em qual posição do ranking de maiores torcidas do Brasil está a torcida do São Paulo??</p>
            </div>

            <div class="alternatives">
                <button class="button_alternatives" onclick="errou()">Primeiro</button>
                <button class="button_alternatives" onclick="errou()">Quinto</button>
                <button class="button_alternatives" onclick="errou()">Quarto</button>
                <button class="button_alternatives" onclick="acertou()">Terceiro</button>
                <button class="button_alternatives" onclick="errou()">Segundo</button>
            </div>
        </div>

        <div id="questions5" class="questions">
            <div class="title_questions">
                <p>5 - Contra que time R. Ceni fez seu 100° Gol?</p>
            </div>
            <div class="alternatives">

                <button class="button_alternatives" onclick="errou()">Palmeiras</button>
                <button class="button_alternatives" onclick="acertou()">Corinthians</button>
                <button class="button_alternatives" onclick="errou()">Santos</button>
                <button class="button_alternatives" onclick="errou()">Ponte Preta</button>
                <button class="button_alternatives" onclick="errou()">Portuguesa</button>
            </div>

        </div>

        <div id="result_quiz">
            <div id="number_of_hits"></div>

            <div id="graphics">
  
              <div class="graphics_size">
                    <canvas id="myChart2"></canvas>
                </div>

            </div>
            <div id="restart">
                <button class="fresh_start" onclick="fresh_start()">Recomeçar</button>
            </div>
        </div>
    </div>

    </div>

</body>

</html>

<script>


    var acertos = 0


    function aparecer_quiz() {

        quiz_content.style.display = "block"

        button_restart.style.display = "none"

        card.style.display = "none"

    }

    function jogar() {
        quiz_content.style.display = "none"

        questions1.style.display = "block"

        button_menu.style.display = "none"

        button_restart.style.display = "block"

        button_msc.style.display = "none"

        message.style.display = "none"

        button_spfc.style.display = "none"
    }

    function acertou() {

        if (questions1.style.display == "block") {

            questions1.style.display = "none"

            questions2.style.display = "block"

            acertos++


        } else if (questions2.style.display == "block") {

            questions2.style.display = "none"

            questions3.style.display = "block"

            acertos++


        } else if (questions3.style.display == "block") {

            questions3.style.display = "none"

            questions4.style.display = "block"

            acertos++


        } else if (questions4.style.display == "block") {

            questions4.style.display = "none"

            questions5.style.display = "block"

            acertos++


        } else {

            questions5.style.display = "none"

            result_quiz.style.display = "block"


            acertos++

            for (var contador = 0; contador <= acertos; contador++) {

                number_of_hits.innerHTML = `Você acertou ${contador} de 5!!!`
            }

            armazenarResultado()

        }


    }

    function errou() {

        if (questions1.style.display == "block") {

            questions1.style.display = "none"

            questions2.style.display = "block"

        } else if (questions2.style.display == "block") {

            questions2.style.display = "none"

            questions3.style.display = "block"

        } else if (questions3.style.display == "block") {

            questions3.style.display = "none"

            questions4.style.display = "block"

        } else if (questions4.style.display == "block") {

            questions4.style.display = "none"

            questions5.style.display = "block"

        } else {
            questions5.style.display = "none"

            result_quiz.style.display = "block"


            for (var contador = 0; contador <= acertos; contador++) {

                number_of_hits.innerHTML = `Você acertou ${contador} de 5!!!`
            }

            armazenarResultado()
        }
    }

    function fresh_start() {
        acertos = 0

        result_quiz.style.display = "none"

        questions1.style.display = "block"
    }


</script>

<script>

    function armazenarResultado() {
        var idUsuarioVar = sessionStorage.ID_USUARIO;
        var resultVar = acertos;

        fetch("/usuarios/armazenarResultado", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({
                resultServer: resultVar,
                idUsuarioServer: idUsuarioVar
            })
        }).then(function (resposta) {
            console.log("resposta: ", resposta);

            if (resposta.ok) {
                console.log("Resultado armazenado com sucesso")
                obterDadosGrafico()
            } else {
                throw ("Houve um erro ao tentar realizar o cadastro!");
            }
        }).catch(function (resposta) {
            console.log(`#ERRO: ${resposta}`);
        });
        
        return false;
    }


    

    
    function obterDadosGrafico() {

        fetch(`/medidas/ultimas`, { cache: 'no-store' }).then(function (response) {
            if (response.ok) {
                response.json().then(function (resposta) {
                    plotarGrafico(resposta);
                });
            } else {
                console.error('Nenhum dado encontrado ou erro na API');
            }
        })
            .catch(function (error) {
                console.error(`Erro na obtenção dos dados p/ gráfico: ${error.message}`);
            });
    }


    // Esta função *plotarGrafico* usa os dados capturados na função anterior para criar o gráfico
    // Configura o gráfico (cores, tipo, etc), materializa-o na página e, 
    // A função *plotarGrafico* também invoca a função *atualizarGrafico*

    // Esta função *atualizarGrafico* atualiza o gráfico que foi renderizado na página,
    // buscando a última medida inserida em tabela contendo as capturas, 

    //     Se quiser alterar a busca, ajuste as regras de negócio em src/controllers
    //     Para ajustar o "select", ajuste o comando sql em src/models

    function plotarGrafico(resposta) {
        console.log(resposta)

        let labels2 = [];

        let data2 = {
            labels: labels2,
            datasets: [{
                label: 'Quantidade de acertos nessa Questão',
                backgroundColor: 'red',
                borderColor: 'white',
                data: [],
            }]
        };

        let config = {
            type: 'line',
            data: data2,
            options: {}
        };

        for (i = 0; i < resposta.length; i++) {

            var registro = resposta[i];
            labels2.push(registro.quantidadeAcertos);
            data2.datasets[0].data.push(registro.quantidadeJogadas)
        }
    
        const myChart = new Chart(
            document.getElementById('myChart2'),
            config
        );



    }


// daods user 
var proximaAtualizacao;
window.onload = obteruser ()

function obteruser() {
    if (proximaAtualizacao != undefined) {
      clearTimeout(proximaAtualizacao);
    }

    fetch(`/medidas/ultimas2`, { cache: 'no-store' }).then((response) => {
      if (response.ok) {
        response.json().then((resposta) => {
            const qtd_user = resposta.response[0].qntd_user;
            plotarGraficoUser(qtd_user)
        })

      } else {
        console.error('Nenhum dado encontrado ou erro na API');
      }
    })
    .catch(function (error) {
        console.error(`Erro na obtenção dos dados p/ gráfico: ${error.message}`);
      });
  }

  function plotarGraficoUser(parm1) {
    var dados = {
      labels: ["Quantidade de usuarios"],
      datasets: [
        {
          yAxisID: 'y-temperatura',
          label: 'Total De São Paulinos',
          borderColor: 'red',
          backgroundColor: 'white',
          fill: true,
          data: []
        }
      ]
    };
    dados.datasets[0].data.push(parm1);
   
    var ctx = myChart.getContext('2d');
    window.grafico_bar = Chart.Bar(ctx, {
      data: dados,
      options: {
        responsive: true,
        animation: { duration: 500 },
        hoverMode: 'index',
        stacked: false,
        title: {
          display: false,
          text: 'Dados capturados'
        },
        scales: {
          yAxes: [{
            type: 'linear',
            display: true,
            position: 'left',
            id: 'y-temperatura',
            ticks: {
              beginAtZero: true,
              max: 50,
              min: 0
            }
          },
          ],
        }
      }
    });

    // setTimeout(() => atualizarGrafico(dados, parm1), 2000);
  } 

  function atualizarGrafico(dados, parm1) {
    console.log();
    fetch(`/medidas/ultimas2`, { cache: 'no-store' }, {
    }).then((response) => {
      if (response.ok) {
        response.json().then((resposta) => {

            const Newparm1 = resposta.user[0][0].qntd_user;


          dados.datasets[0].data = [];
        
          dados.datasets[0].data.push(NewParm1);


          window.grafico_bar.update();

          proximaAtualizacao = setTimeout(() => atualizarGrafico(dados, parm1), 2000);
        });
      } else {
        console.error('Nenhum dado encontrado ou erro na API');
        // Altere aqui o valor em ms se quiser que o gráfico atualize mais rápido ou mais devagar
        proximaAtualizacao = setTimeout(() => atualizarGrafico(dados, parm1, parm2, parm3), 2000);
      }
    })
      .catch(function (error) {
        console.error(`Erro na obtenção dos dados p/ gráfico: ${error.message}`);
      });

  }

// </script>